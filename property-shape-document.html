<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="api-type-document.html">
<link rel="import" href="property-range-document.html">
<link rel="import" href="propery-document-mixin.html">
<dom-module id="property-shape-document">
  <template>
    <style>
    :host {
      display: block;
      padding: 4px 8px;
      @apply --property-shape-document;
    }

    :host([is-array]) {
      border-left: 1px var(--property-shape-document-array-color, #8BC34A) solid;
    }

    :host([is-object]) {
      border-left: 1px var(--property-shape-document-object-color, #FF9800) solid;
    }

    :host([is-union]) {
      border-left: 1px var(--property-shape-document-union-color, #FFEB3B) solid;
    }

    :host > .children {
      margin-left: 4px; /* It adds to 8 px padding from :host */
    }

    [hidden] {
      display: none !important;
    }

    .property-title {
      @apply --arc-font-subhead;
      margin: 0 0 12px 0;
      @apply --property-shape-document-title;
    }

    .parent-label {
      color: var(--api-type-document-property-parent-color, #757575);
    }

    .property-name {
      font-weight: 400;
      color: var(--api-type-document-property-color, #757575);
    }
    </style>
    <template is="dom-if" if="[[displayName]]">
      <h4 class="property-title">
        <template is="dom-if" if="[[parentTypeName]]"><span class="parent-label">[[parentTypeName]].</span></template><span>[[displayName]]</span>
        <template is="dom-if" if="[[hasDisplayName]]">
          <span class="property-name" title="Parameter name in API communication">([[propertyName]])</span>
        </template>
      </h4>
    </template>
    <property-range-document amf-model="[[amfModel]]" shape="[[shape]]" range="[[range]]"></property-range-document>
    <template is="dom-if" if="[[isArray]]">
      <api-type-document class="children" amf-model="[[amfModel]]" type="[[range]]" parent-type-name="item"></api-type-document>
    </template>
    <template is="dom-if" if="[[isObject]]">
      <api-type-document class="children" amf-model="[[amfModel]]" type="[[range]]" parent-type-name="[[displayName]]"></api-type-document>
    </template>
    <template is="dom-if" if="[[isUnion]]">
      <api-type-document class="children" amf-model="[[amfModel]]" type="[[range]]" parent-type-name="[[displayName]]"></api-type-document>
    </template>
  </template>
  <script>
  /**
   * `property-shape-document`
   *
   * Renders a documentation for a shape property of AMF model.
   *
   * ## Styling
   *
   * `<property-shape-document>` provides the following custom properties and mixins for styling:
   *
   * Custom property | Description | Default
   * ----------------|-------------|----------
   * `--property-shape-document` | Mixin applied to this elment | `{}`
   * `--property-shape-document-array-color` | Property border color when type is an array | `#8BC34A`
   * `--property-shape-document-object-color` | Property border color when type is an object | `#FF9800`
   * `--property-shape-document-union-color` | Property border color when type is an union | `#FFEB3B`
   * `--arc-font-subhead` | Theme mixin, applied to the property title | `{}`
   * `--property-shape-document-title` | Mixin applied to the property title | `{}`
   * `--api-type-document-property-parent-color` | Color of the parent property label | `#757575`
   * `--api-type-document-property-color` | Color of the property name label when display name is used | `#757575`
   *
   * @customElement
   * @polymer
   * @demo demo/index.html
   * @memberof ApiElements
   * @appliesMixin ArcBehaviors.PropertyDocumentMixin
   */
  class PropertyShapeDocument extends ArcBehaviors.PropertyDocumentMixin(Polymer.Element) {
    static get is() { return 'property-shape-document'; }
    static get properties() {
      return {
        /**
         * Computed value of shape's http://raml.org/vocabularies/shapes#range
         * @type {Object}
         */
        range: {
          type: Object,
          computed: '_computeRange(shape)'
        },
        /**
         * Computed value of "display name" of the property
         */
        displayName: {
          type: String,
          computed: '_computeDisplayName(range, shape)'
        },
        /**
         * A type property name.
         * This may be different from `displayName` property if
         * `displayName` was specified in the API spec for this property.
         */
        propertyName: {
          type: String,
          computed: '_computePropertyName(range, shape)'
        },
        /**
         * Computed value, true if `displayName` has been defined for this
         * property.
         */
        hasDisplayName: {
          type: Boolean,
          computed: '_computeHasDisplayName(range)'
        },
        /**
         * Computed value form the shape. True if the property is required.
         */
        isRequired: {
          type: Boolean,
          computed: '_computeIsRequired(shape)'
        },
        /**
         * Computed value, true if current property is an union.
         */
        isUnion: {
          type: Boolean,
          computed: '_computeIsUnion(range)',
          reflectToAttribute: true
        },
        /**
         * Computed value, true if current property is an object.
         */
         isObject: {
          type: Boolean,
          computed: '_computeIsObject(range)',
          reflectToAttribute: true
        },
        /**
         * Computed value, true if current property is an array.
         */
        isArray: {
          type: Boolean,
          computed: '_computeIsArray(range)',
          reflectToAttribute: true
        },
        /**
         * Should be set if described properties has a parent type.
         * This is used when recursively iterating over properties.
         */
        parentTypeName: String
      };
    }
    /**
     * Computes name of the property. This may be different from the
     * `displayName` if `displayName` is set in API spec.
     *
     * @param {Object} range Range object of current shape.
     * @return {String} Display name of the property
     */
    _computePropertyName(range) {
      return this._getValue(range, 'http://www.w3.org/ns/shacl#name');
    }
    /**
     * Computes value for `hasDisplayName` property.
     * Indicates that `displayName` has been defined in the API specification.
     *
     * @param {Object} range Range object of current shape.
     * @return {Boolean}
     */
    _computeHasDisplayName(range) {
      return !!this._getValue(range, 'http://schema.org/name');
    }
    /**
     * Computes value for `isRequired` property.
     * In AMF model a property is required when `http://www.w3.org/ns/shacl#minCount`
     * does not equal `0`.
     *
     * @param {Object} shape Current shape object
     * @return {Boolean}
     */
    _computeIsRequired(shape) {
      const data = this._getValue(shape, 'http://www.w3.org/ns/shacl#minCount');
      return data !== 0;
    }
  }
  window.customElements.define(PropertyShapeDocument.is, PropertyShapeDocument);
  </script>
</dom-module>
